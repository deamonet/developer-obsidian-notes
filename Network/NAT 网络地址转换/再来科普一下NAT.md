再来科普一下NAT。

IP地址只有32位，满打满算只有42.9亿个地址，还要去掉保留地址、组播地址，能用得只有36亿左右，IPv4很早就被列强瓜分完毕，感谢有NAT这项技术苦苦支撑，我们还可以继续在互联网遨游。

公司局域网、机构局域网、个人局域网可以使用私网IPv4地址（10.0.0.0/8，172.16.0.0/12，192.168.0.0/16），然后在各个局域网的边界WAN口使用一个或多个公网IPv4进行一对多的转换。

如果是一对一转换，那压根节省不了IPv4地址空间；所以一般NAT都是一对多的，即一个公网IPv4映射多个私网IPv4，那问题来了，NAT设备如何区分不同的私网IPv4 的host呢？

NAT使用基于session 转换规则：

**对于TCP/UDP 使用**  
Host 's 私有IPv4 + Port <------> NAT 公网IPv4 + Port

**对于ICMP使用**  
Host 's 私有IPv4 + session ID <------> NAT 公网IPv4 + session ID

规则其实非常好理解，**由于session ID 在NAT设备上是独一无二的，所以NAT可以很容易区别局域网内部的不同host。**

至于其它传输协议，NAT使用的也是类似session ID 的转换规则，即使用可以将不同host 轻易分辨出来的字段做**键值（KEY）**，动态创建映射表项，做双向的地址+ KEY 的转换。

[编辑于 2019-04-16 23:20](https://www.zhihu.com/question/31332694/answer/118410360)